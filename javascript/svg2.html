<!DOCTYPE html>
<html lang="ja-jp">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SVG2</title>
    <style>
        body{
            padding: 0;
            margin: 0;
        }
        svg{
            background-color: black;
            margin: 2px;
        }
        .svgContainer{
            margin:0;
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
            justify-content: space-around;
        }
        #status{
            background-color: darkblue;
            color:white;
            padding:5px;
        }
        text{
            text-align: right;
        }
    </style>
    <script>
        document.addEventListener('DOMContentLoaded',()=>{
            const status = document.getElementById('status');
            const svg2 = document.getElementById('svg');
            // const pathScale = document.getElementById('pathScale');
            class Svg{
                constructor(size,scale,id,offSet){
                    this.size = size;
                    this.scale = scale;
                    this.element = document.getElementById(id);
                    this.offSet = offSet;
                    this.obj = document.getElementById(id);
                    this.graphSize = size - offSet;
                    this.realUnit = scale.unit * this.graphSize / size; 
                }
                
            };
            const svg1 = new Svg(300,{max:300,unit:50},'svg',35)
            // const svgSize = 300;
            // let scale = {
            //     max:300,
            //     unit:50,
            // };
            // const offSet = 20;

            status.textContent = 'width:'+window.innerWidth+', height:'+window.innerHeight+', svg:'+svg.clientWidth+'x'+svg.clientHeight;
            initSVG(svg1);
            const data1 = [10,50,40,20,80,120,100];
            draw(svg1,data1);

            function draw(svg,data){
                let strD='';

                plotScale(svg);

                strD='M '+svg.offSet+' ' + (svg.size - svg.offSet - data[0]) + ' ';
                scale = (svg.size - svg.offSet)/(data.length - 1);
                for(let i = 1; i <= data.length - 1; i++){
                    strD += 'L '+(Math.round(i * svg.realUnit*10)/10 + svg.offSet)+' '+(svg.size - svg.offSet - Math.round(data[i]/svg.scale.unit*svg.realUnit*10)/10)
                }

                const pathData = document.createElementNS('http://www.w3.org/2000/svg','path');
                pathData.setAttribute('d',strD);
                pathData.setAttribute('stroke','rgb(0,255,0)');
                pathData.setAttribute('stroke-width','2');
                pathData.setAttribute('fill','transparent');
                svg.obj.appendChild(pathData);
            }

            function plotScale(svg){
                let scale = 0;
                for(let i = 0; i<=svg.graphSize; i+=svg.realUnit){
                    const scaleData = document.createElementNS('http://www.w3.org/2000/svg','text');
                    scaleData.setAttribute('x',8);
                    scaleData.setAttribute('y',Math.round((svg.graphSize-i)*10)/10+4);
                    scaleData.setAttribute('font-size',14);
                    scaleData.setAttribute('fill','white')
                    scaleData.textContent= scale.toString().padStart(3,'_');
                    scale+=svg.scale.unit;
                    console.log(scale.toString().padStart(3,' '))
                    svg.obj.appendChild(scaleData);
                }
            }

            function initSVG(svg){
                const graphSize = svg.size - svg.offSet;
                const pathScale = document.createElementNS('http://www.w3.org/2000/svg','path');
                const path1 = document.getElementById('path1');
                svg.obj.setAttribute('width',svg.size);
                svg.obj.setAttribute('height',svg.size);
                let strScale = ''
                for(let i = 0; i<=svg.graphSize; i+=svg.realUnit){
                    strScale += 'M '+(Math.round((i+svg.offSet)*10)/10)+' 0 v '+graphSize+' ';
                    strScale += 'M '+svg.offSet+' '+Math.round(i*10)/10+' h '+graphSize+' ';
                }
                pathScale.setAttribute('d',strScale);
                pathScale.setAttribute('stroke','rgba(200,200,200,0.8)');
                svg.obj.appendChild(pathScale);
                console.log(pathScale);
            }
        });
    </script>
</head>
<body>
    <h1>SVGの練習2</h1>
    <div class="svgContainer">
        <svg id="svg" width="300" height="300">
        </svg>
    </div>
    <div id="status">Status</div>
</body>
</html>